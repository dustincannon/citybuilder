<!DOCTYPE html>
<html>
  <head>
    <title>Ruby on Rails: Welcome aboard</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-responsive.min.css">
	<link rel="stylesheet" href="css/custom-theme/jquery-ui-1.8.16.custom.css">
	<link rel="stylesheet" href="css/custom-theme/jquery.ui.1.8.16.ie.css">
  </head>
  <body>
    <div id="page" style="padding: 2em;">
      
		<div data-budget_categories-key="a" id="slider"></div>
      	<div id="slider-cost">Line Item A: <span></span></div>
		<div data-budget_categories-key="b" id="slider-1"></div>
      	<div id="slider-1-cost">Line Item B: <span></span></div>
		<div data-budget_categories-key="c" id="slider-2"></div>
      	<div id="slider-2-cost">Line Item C: <span></span></div>
		<div data-budget_categories-key="d" id="slider-3"></div>
      	<div id="slider-3-cost">Line Item D: <span></span></div>


      	<div id="total-slider"></div>
      	<div id="total-slider-cost">Income: <span></span></div>
      	<div id="total-budget-cost">Expenditures: <span></span></div>
      	<div id="total-discrepancy">Discrepancy: <span></span></div>
    </div>
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.23.custom.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script>

		var budget_init = 1000,
			budget_categories = {
				a: 100,
				b: 50,
				c: 250,
				d: 150
			},
			$dependents = $('[id^=slider]').filter(':not([id$=cost])');

			$dependents.each(function(){
				var $slider = $(this);
				$slider.slider({
		        	range: 'min',
					min: 1,
					max: budget_init,
					value: budget_categories[$slider.data('budget_categories-key')],
					slide: updateLineItem,
					create: updateLineItem
		    	});
			});
		
		function updateLineItem( e, ui )
		{
			var $slider = $(this),
				value = ui.value || ( budget_categories[$slider.data('budget_categories-key')] || 0);
			
			$( '#' + $slider.attr('id') + '-cost span' ).text( '$' + value );
			
			updateExpenditures( e, ui );
		}

		function updateIncome( e, ui )
		{
			var $slider = $('#total-slider'),
				value = ui.value || budget_init;
			
			$( '#' + $slider.attr('id') + '-cost span' ).text( '$' + value );
			
			updateMaxValues( e, ui );

			updateDiscrepancy();
		};

		function updateExpenditures( e, ui )
		{
			var total = 0;
			
			$dependents.each(function(){
				total += parseInt($(this).slider('value'),10);
			});
			$('#total-budget-cost span').text( '$' + total );

			updateDiscrepancy();
		}

		function updateDiscrepancy()
		{
			console.log($('#total-slider-cost span').text(),$('#total-budget-cost span').text());
			var diff = parseInt($('#total-slider-cost span').text().replace('$',''), 10) - parseInt($('#total-budget-cost span').text().replace('$',''), 10);
			$('#total-discrepancy span').text('$'+diff);
		}

		function updateMaxValues( e, ui )
		{
			$dependents.slider('option','max',ui.value);
			$dependents
				.each(function(){
					$(this).slider('option','value',$(this).slider('value'));
				});
			
		}


		$('#total-slider').slider({
			range: 'min',
			min: $dependents.length,
			max: 5000,
			value: budget_init,
			slide: updateIncome,
			create: updateIncome
		});
	</script>
  </body>
</html>
